/*!
 *
 * Jquery Mapael - Dynamic maps jQuery plugin (based on raphael.js)
 * Requires jQuery, raphael.js and jquery.mousewheel
 *
 * Version: 1.1.0
 *
 * Copyright (c) 2015 Vincent Brout√© (http://www.vincentbroute.fr/mapael)
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php).
 *
 * Thanks to Indigo744
 *
 */
!function(a){"object"==typeof exports?module.exports=a(require("jquery"),require("raphael"),require("mousewheel")):"function"==typeof define&&define.amd?define(["jquery","raphael","mousewheel"],a):a(jQuery,Raphael,jQuery.fn.mousewheel)}(function(a,b,c){"use strict";var d=function(c){return c=a.extend(!0,{},d.defaultOptions,c),a.each(c.legend,function(b){if(a.isArray(c.legend[b]))for(var e=0;e<c.legend[b].length;++e)c.legend[b][e]=a.extend(!0,{},d.legendDefaultOptions[b],c.legend[b][e]);else c.legend[b]=a.extend(!0,{},d.legendDefaultOptions[b],c.legend[b])}),this.each(function(){var e=a(this),f=a("<div>").addClass(c.map.tooltip.cssClass).css("display","none"),g=a("."+c.map.cssClass,this).empty().append(f),h=a.fn.mapael.maps[c.map.name],i=new b(g[0],h.width,h.height),j={},k=0,l={},m={},n={},o=0,p=0,q=0;if(c.map.tooltip.css&&f.css(c.map.tooltip.css),i.setViewBox(0,0,h.width,h.height,!1),a.each(h.elems,function(a){j=d.getElemOptions(c.map.defaultArea,c.areas[a]?c.areas[a]:{},c.legend.area),l[a]={mapElem:i.path(h.elems[a]).attr(j.attrs)}}),c.map.beforeInit&&c.map.beforeInit(e,i,c),a.each(h.elems,function(a){j=d.getElemOptions(c.map.defaultArea,c.areas[a]?c.areas[a]:{},c.legend.area),d.initElem(i,l[a],j,f,a)}),n=d.drawLinksCollection(i,c,c.links,h.getCoords,f),a.each(c.plots,function(a){m[a]=d.drawPlot(a,c,h,i,f)}),e.on("zoom",function(a,b){var f=Math.min(Math.max(b.level,0),c.map.zoom.maxLevel),j=0,k=0,l=1+e.data("zoomLevel")*c.map.zoom.step,m=1+f*c.map.zoom.step,n="undefined"!=typeof b.animDuration?b.animDuration:c.map.zoom.animDuration,o=0,p=0,q={};"undefined"!=typeof b.latitude&&"undefined"!=typeof b.longitude&&(q=h.getCoords(b.latitude,b.longitude),b.x=q.x,b.y=q.y),"undefined"==typeof b.x&&(b.x=i._viewBox[0]+i._viewBox[2]/2),"undefined"==typeof b.y&&(b.y=i._viewBox[1]+i._viewBox[3]/2),0===f?(j=0,k=0):"undefined"!=typeof b.fixedCenter&&b.fixedCenter===!0?(o=e.data("panX")+(b.x-e.data("panX"))*(m-l)/m,p=e.data("panY")+(b.y-e.data("panY"))*(m-l)/m,j=Math.min(Math.max(0,o),h.width-h.width/m),k=Math.min(Math.max(0,p),h.height-h.height/m)):(j=Math.min(Math.max(0,b.x-h.width/m/2),h.width-h.width/m),k=Math.min(Math.max(0,b.y-h.height/m/2),h.height-h.height/m)),(m!=l||j!=e.data("panX")||k!=e.data("panY"))&&(n>0?d.animateViewBox(g,i,j,k,h.width/m,h.height/m,n,c.map.zoom.animEasing):(i.setViewBox(j,k,h.width/m,h.height/m),clearTimeout(d.zoomTO),d.zoomTO=setTimeout(function(){g.trigger("afterZoom",{x1:j,y1:k,x2:j+h.width/m,y2:k+h.height/m})},150)),e.data({zoomLevel:f,panX:j,panY:k,zoomX:j+i._viewBox[2]/2,zoomY:k+i._viewBox[3]/2}))}),c.map.zoom.enabled&&c.map.zoom.mousewheel&&e.on("mousewheel",function(b){var f=g.offset(),h=c.map.width?d.maps[c.map.name].width/c.map.width:d.maps[c.map.name].width/g.width(),i=b.deltaY>0?1:-1,j=1/(1+e.data("zoomLevel")*c.map.zoom.step),k=j*h*(b.clientX+a(window).scrollLeft()-f.left)+e.data("panX"),l=j*h*(b.clientY+a(window).scrollTop()-f.top)+e.data("panY");return e.trigger("zoom",{fixedCenter:!0,level:e.data("zoomLevel")+i,x:k,y:l}),!1}),c.map.zoom.enabled&&c.map.zoom.touch&&e.on("touchstart",function(a){2===a.originalEvent.touches.length&&(o=(a.originalEvent.touches[0].clientX+a.originalEvent.touches[1].clientX)/2,p=(a.originalEvent.touches[0].clientY+a.originalEvent.touches[1].clientY)/2,q=Math.sqrt(Math.pow(a.originalEvent.touches[1].clientX-a.originalEvent.touches[0].clientX,2)+Math.pow(a.originalEvent.touches[1].clientY-a.originalEvent.touches[0].clientY,2)))}),c.map.zoom.enabled&&c.map.zoom.touch&&e.on("touchmove",function(b){var f=0,h=0,i=0,j=0,k=0,l=0,m=0;return 2===b.originalEvent.touches.length?(l=Math.sqrt(Math.pow(b.originalEvent.touches[1].clientX-b.originalEvent.touches[0].clientX,2)+Math.pow(b.originalEvent.touches[1].clientY-b.originalEvent.touches[0].clientY,2)),Math.abs(l-q)>15&&(f=g.offset(),h=c.map.width?d.maps[c.map.name].width/c.map.width:a.fn.mapael.maps[c.map.name].width/g.width(),i=1/(1+e.data("zoomLevel")*c.map.zoom.step),j=i*h*(o+a(window).scrollLeft()-f.left)+e.data("panX"),k=i*h*(p+a(window).scrollTop()-f.top)+e.data("panY"),m=(l-q)/Math.abs(l-q),e.trigger("zoom",{fixedCenter:!0,level:e.data("zoomLevel")+m,x:j,y:k}),q=l),!1):void 0}),c.map.zoom.enabled&&d.initZoom(g,i,h.width,h.height,c.map.zoom),"undefined"!=typeof c.map.zoom.init&&("undefined"==typeof c.map.zoom.init.animDuration&&(c.map.zoom.init.animDuration=0),e.trigger("zoom",c.map.zoom.init)),d.createLegends(e,c,"area",l,1),e.on("update",function(b,j,k,o,p){var q=0,r=0,s={},t=!0;if("undefined"!=typeof p&&"string"==typeof p.setLegendElemsState&&(t="hide"===p.setLegendElemsState?!1:!0),"undefined"!=typeof p&&(p.resetAreas&&(c.areas={}),p.resetPlots&&(c.plots={}),p.resetLinks&&(c.links={}),p.animDuration&&(r=p.animDuration)),a.extend(!0,c,j),"object"==typeof o)for(;q<o.length;q++)"undefined"!=typeof m[o[q]]&&(r>0?!function(a){a.mapElem.animate({opacity:0},r,"linear",function(){a.mapElem.remove()}),a.textElem&&a.textElem.animate({opacity:0},r,"linear",function(){a.textElem.remove()})}(m[o[q]]):(m[o[q]].mapElem.remove(),m[o[q]].textElem&&m[o[q]].textElem.remove()),delete m[o[q]]);if("undefined"!=typeof p&&"object"==typeof p.deletedLinks)for(q=0;q<p.deletedLinks.length;q++)"undefined"!=typeof n[p.deletedLinks[q]]&&(r>0?!function(a){a.mapElem.animate({opacity:0},r,"linear",function(){a.mapElem.remove()}),a.textElem&&a.textElem.animate({opacity:0},r,"linear",function(){a.textElem.remove()})}(n[p.deletedLinks[q]]):(n[p.deletedLinks[q]].mapElem.remove(),n[p.deletedLinks[q]].textElem&&n[p.deletedLinks[q]].textElem.remove()),delete n[p.deletedLinks[q]]);if("object"==typeof k&&a.each(k,function(a){"undefined"==typeof m[a]&&(c.plots[a]=k[a],m[a]=d.drawPlot(a,c,h,i,f),r>0&&(m[a].mapElem.attr({opacity:0}),m[a].mapElem.animate({opacity:"undefined"!=typeof m[a].mapElem.originalAttrs.opacity?m[a].mapElem.originalAttrs.opacity:1},r),m[a].textElem&&(m[a].textElem.attr({opacity:0}),m[a].textElem.animate({opacity:"undefined"!=typeof m[a].textElem.originalAttrs.opacity?m[a].textElem.originalAttrs.opacity:1},r))))}),"undefined"!=typeof p&&"object"==typeof p.newLinks){var u=d.drawLinksCollection(i,c,p.newLinks,h.getCoords,f);a.extend(n,u),a.extend(c.links,p.newLinks),r>0&&a.each(u,function(a){u[a].mapElem.attr({opacity:0}),u[a].mapElem.animate({opacity:"undefined"!=typeof u[a].mapElem.originalAttrs.opacity?u[a].mapElem.originalAttrs.opacity:1},r),u[a].textElem&&(u[a].textElem.attr({opacity:0}),u[a].textElem.animate({opacity:"undefined"!=typeof u[a].textElem.originalAttrs.opacity?u[a].textElem.originalAttrs.opacity:1},r))})}a.each(l,function(a){s=d.getElemOptions(c.map.defaultArea,c.areas[a]?c.areas[a]:{},c.legend.area),d.updateElem(s,l[a],f,r)}),a.each(m,function(a){s=d.getElemOptions(c.map.defaultPlot,c.plots[a]?c.plots[a]:{},c.legend.plot),"square"==s.type?(s.attrs.width=s.size,s.attrs.height=s.size,s.attrs.x=m[a].mapElem.attrs.x-(s.size-m[a].mapElem.attrs.width)/2,s.attrs.y=m[a].mapElem.attrs.y-(s.size-m[a].mapElem.attrs.height)/2):"image"==s.type?(s.attrs.width=s.width,s.attrs.height=s.height,s.attrs.x=m[a].mapElem.attrs.x-(s.width-m[a].mapElem.attrs.width)/2,s.attrs.y=m[a].mapElem.attrs.y-(s.height-m[a].mapElem.attrs.height)/2):s.attrs.r=s.size/2,d.updateElem(s,m[a],f,r)}),a.each(n,function(a){s=d.getElemOptions(c.map.defaultLink,c.links[a]?c.links[a]:{},{}),d.updateElem(s,n[a],f,r)}),"undefined"!=typeof j&&"object"==typeof j.legend&&(d.createLegends(e,c,"area",l,1),c.map.width?d.createLegends(e,c,"plot",m,c.map.width/h.width):d.createLegends(e,c,"plot",m,g.width()/h.width)),a("[data-type='elem']",a(this)).each(function(){("0"===a(this).attr("data-hidden")&&t===!1||"1"===a(this).attr("data-hidden")&&t===!0)&&a(this).trigger("click",!1)}),"undefined"!=typeof p&&p.afterUpdate&&p.afterUpdate(e,i,l,m,c)}),c.map.width)i.setSize(c.map.width,h.height*(c.map.width/h.width)),d.createLegends(e,c,"plot",m,c.map.width/h.width);else{a(window).on("resize",function(){clearTimeout(k),k=setTimeout(function(){g.trigger("resizeEnd")},150)});var r=function(){d.createLegends(e,c,"plot",m,g.width()/h.width),g.unbind("resizeEnd",r)};g.on("resizeEnd",function(){var a=g.width();i.width!=a&&i.setSize(a,h.height*(a/h.width))}).on("resizeEnd",r).trigger("resizeEnd")}c.map.afterInit&&c.map.afterInit(e,i,l,m,c),a(i.desc).append(" and Mapael (http://www.vincentbroute.fr/mapael/)")})};return d.version="1.1.0",d.zoomTO=0,d.initElem=function(b,c,e,f,g){var h={},i={};"undefined"!=typeof e.value&&(c.value=e.value),d.setHoverOptions(c.mapElem,e.attrs,e.attrsHover),e.text&&"undefined"!=typeof e.text.content?(h=c.mapElem.getBBox(),i=d.getTextPosition(h,e.text.position,e.text.margin),e.text.attrs["text-anchor"]=i.textAnchor,c.textElem=b.text(i.x,i.y,e.text.content).attr(e.text.attrs),d.setHoverOptions(c.textElem,e.text.attrs,e.text.attrsHover),e.eventHandlers&&d.setEventHandlers(g,e,c.mapElem,c.textElem),d.setHover(b,c.mapElem,c.textElem),a(c.textElem.node).attr("data-id",g)):(e.eventHandlers&&d.setEventHandlers(g,e,c.mapElem),d.setHover(b,c.mapElem)),e.tooltip&&(c.mapElem.tooltip=e.tooltip,d.setTooltip(c.mapElem,f),e.text&&"undefined"!=typeof e.text.content&&(c.textElem.tooltip=e.tooltip,d.setTooltip(c.textElem,f))),e.href&&(c.mapElem.href=e.href,c.mapElem.target=e.target,d.setHref(c.mapElem),e.text&&"undefined"!=typeof e.text.content&&(c.textElem.href=e.href,c.textElem.target=e.target,d.setHref(c.textElem))),a(c.mapElem.node).attr("data-id",g)},d.drawLinksCollection=function(b,c,e,f,g){var h={},i={},j={},k={},l={},m={};return a.each(e,function(a){j=d.getElemOptions(c.map.defaultLink,e[a],{}),h="string"==typeof e[a].between[0]?c.plots[e[a].between[0]]:e[a].between[0],i="string"==typeof e[a].between[1]?c.plots[e[a].between[1]]:e[a].between[1],"undefined"!=typeof h.latitude&&"undefined"!=typeof h.longitude?k=f(h.latitude,h.longitude):(k.x=h.x,k.y=h.y),"undefined"!=typeof i.latitude&&"undefined"!=typeof i.longitude?l=f(i.latitude,i.longitude):(l.x=i.x,l.y=i.y),m[a]=d.drawLink(a,b,k.x,k.y,l.x,l.y,j,g)}),m},d.drawLink=function(a,b,c,e,f,g,h,i){var j={},k=(c+f)/2,l=(e+g)/2,m=-1/((g-e)/(f-c)),n=l-m*k,o=Math.sqrt((f-c)*(f-c)+(g-e)*(g-e)),p=1+m*m,q=-2*k+2*m*n-2*m*l,r=k*k+n*n-n*l-l*n+l*l-h.factor*o*(h.factor*o),s=q*q-4*p*r,t=0,u=0;return h.factor>0?(t=(-q+Math.sqrt(s))/(2*p),u=m*t+n):(t=(-q-Math.sqrt(s))/(2*p),u=m*t+n),j.mapElem=b.path("m "+c+","+e+" C "+t+","+u+" "+f+","+g+" "+f+","+g).attr(h.attrs),d.initElem(b,j,h,i,a),j},d.updateElem=function(a,b,c,e){var f,g,h,i;"undefined"!=typeof a.value&&(b.value=a.value),b.textElem&&("undefined"!=typeof a.text&&"undefined"!=typeof a.text.content&&a.text.content!=b.textElem.attrs.text&&b.textElem.attr({text:a.text.content}),f=b.mapElem.getBBox(),(a.size||a.width&&a.height)&&("image"==a.type||"svg"==a.type?(h=(a.width-f.width)/2,i=(a.height-f.height)/2):(h=(a.size-f.width)/2,i=(a.size-f.height)/2),f.x-=h,f.x2+=h,f.y-=i,f.y2+=i),g=d.getTextPosition(f,a.text.position,a.text.margin),(g.x!=b.textElem.attrs.x||g.y!=b.textElem.attrs.y)&&(e>0?(b.textElem.attr({"text-anchor":g.textAnchor}),b.textElem.animate({x:g.x,y:g.y},e)):b.textElem.attr({x:g.x,y:g.y,"text-anchor":g.textAnchor})),d.setHoverOptions(b.textElem,a.text.attrs,a.text.attrsHover),e>0?b.textElem.animate(a.text.attrs,e):b.textElem.attr(a.text.attrs)),d.setHoverOptions(b.mapElem,a.attrs,a.attrsHover),e>0?b.mapElem.animate(a.attrs,e):b.mapElem.attr(a.attrs),"svg"==a.type&&b.mapElem.transform("m"+a.width/b.mapElem.originalWidth+",0,0,"+a.height/b.mapElem.originalHeight+","+f.x+","+f.y),a.tooltip&&("undefined"==typeof b.mapElem.tooltip&&(d.setTooltip(b.mapElem,c),b.textElem&&d.setTooltip(b.textElem,c)),b.mapElem.tooltip=a.tooltip,b.textElem&&(b.textElem.tooltip=a.tooltip)),"undefined"!=typeof a.href&&("undefined"==typeof b.mapElem.href&&(d.setHref(b.mapElem),b.textElem&&d.setHref(b.textElem)),b.mapElem.href=a.href,b.mapElem.target=a.target,b.textElem&&(b.textElem.href=a.href,b.textElem.target=a.target))},d.drawPlot=function(a,b,c,e,f){var g={},h={},i=d.getElemOptions(b.map.defaultPlot,b.plots[a]?b.plots[a]:{},b.legend.plot);return h="undefined"!=typeof i.x&&"undefined"!=typeof i.y?{x:i.x,y:i.y}:c.getCoords(i.latitude,i.longitude),"square"==i.type?g={mapElem:e.rect(h.x-i.size/2,h.y-i.size/2,i.size,i.size).attr(i.attrs)}:"image"==i.type?g={mapElem:e.image(i.url,h.x-i.width/2,h.y-i.height/2,i.width,i.height).attr(i.attrs)}:"svg"==i.type?(g={mapElem:e.path(i.path).attr(i.attrs)},g.mapElem.originalWidth=g.mapElem.getBBox().width,g.mapElem.originalHeight=g.mapElem.getBBox().height,g.mapElem.transform("m"+i.width/g.mapElem.originalWidth+",0,0,"+i.height/g.mapElem.originalHeight+","+(h.x-i.width/2)+","+(h.y-i.height/2))):g={mapElem:e.circle(h.x,h.y,i.size/2).attr(i.attrs)},d.initElem(e,g,i,f,a),g},d.setHref=function(b){b.attr({cursor:"pointer"}),a(b.node).bind("click",function(){!d.panning&&b.href&&window.open(b.href,b.target)})},d.setTooltip=function(b,c){var d=0,e=c.parent(),f=c.attr("class"),g=function(a,d){var f={left:Math.min(e.width()-c.outerWidth()-5,a-e.offset().left+10),top:Math.min(e.height()-c.outerHeight()-5,d-e.offset().top+20)};"undefined"!=typeof b.tooltip.overflow&&("undefined"!=typeof b.tooltip.overflow.right&&b.tooltip.overflow.right===!0&&(f.left=a-e.offset().left+10),"undefined"!=typeof b.tooltip.overflow.bottom&&b.tooltip.overflow.bottom===!0&&(f.top=d-e.offset().top+20)),c.css(f)};a(b.node).on("mouseover",function(a){d=setTimeout(function(){c.attr("class",f),"undefined"!=typeof b.tooltip&&("undefined"!=typeof b.tooltip.content&&c.html(b.tooltip.content).css("display","block"),"undefined"!=typeof b.tooltip.cssClass&&c.addClass(b.tooltip.cssClass)),g(a.pageX,a.pageY)},120)}).on("mouseout",function(){clearTimeout(d),c.css("display","none")}).on("mousemove",function(a){g(a.pageX,a.pageY)})},d.setEventHandlers=function(b,c,e,f){a.each(c.eventHandlers,function(g){!function(g){a(e.node).on(g,function(a){!d.panning&&c.eventHandlers[g](a,b,e,f,c)}),f&&a(f.node).on(g,function(a){!d.panning&&c.eventHandlers[g](a,b,e,f,c)})}(g)})},d.panning=!1,d.panningTO=0,d.initZoom=function(b,c,e,f,g){var h=b.parent(),i=a("<div>").addClass(g.zoomInCssClass).html("+"),j=a("<div>").addClass(g.zoomOutCssClass).html("&#x2212;"),k=!1,l=0,m=0;h.data("zoomLevel",0).data({panX:0,panY:0}),b.append(i).append(j),i.on("click",function(){h.trigger("zoom",{level:h.data("zoomLevel")+1})}),j.on("click",function(){h.trigger("zoom",{level:h.data("zoomLevel")-1})}),a("body").on("mouseup"+(g.touch?" touchend":""),function(){k=!1,setTimeout(function(){d.panning=!1},50)}),b.on("mousedown"+(g.touch?" touchstart":""),function(a){"undefined"!=typeof a.pageX?(k=!0,l=a.pageX,m=a.pageY):1===a.originalEvent.touches.length&&(k=!0,l=a.originalEvent.touches[0].pageX,m=a.originalEvent.touches[0].pageY)}).on("mousemove"+(g.touch?" touchmove":""),function(a){var i=h.data("zoomLevel"),j=0,n=0;if("undefined"!=typeof a.pageX?(j=a.pageX,n=a.pageY):1===a.originalEvent.touches.length?(j=a.originalEvent.touches[0].pageX,n=a.originalEvent.touches[0].pageY):k=!1,k&&0!==i){var o=(l-j)/(1+i*g.step)*(e/c.width),p=(m-n)/(1+i*g.step)*(f/c.height),q=Math.min(Math.max(0,c._viewBox[0]+o),e-c._viewBox[2]),r=Math.min(Math.max(0,c._viewBox[1]+p),f-c._viewBox[3]);return(Math.abs(o)>5||Math.abs(p)>5)&&(h.data({panX:q,panY:r,zoomX:q+c._viewBox[2]/2,zoomY:r+c._viewBox[3]/2}),c.setViewBox(q,r,c._viewBox[2],c._viewBox[3]),clearTimeout(d.panningTO),d.panningTO=setTimeout(function(){b.trigger("afterPanning",{x1:q,y1:r,x2:q+c._viewBox[2],y2:r+c._viewBox[3]})},150),l=j,m=n,d.panning=!0),!1}})},d.drawLegend=function(c,e,f,g,h,i,j){var k={},l={},m=0,n=0,o=null,p={},q={},r={},s=0,t=0,u=0,v=0,w=[],x=0;for(k=a("."+c.cssClass,e).empty(),l=new b(k.get(0)),n=m=0,c.title&&""!==c.title&&(o=l.text(c.marginLeftTitle,0,c.title).attr(c.titleAttrs),o.attr({y:.5*o.getBBox().height}),m=c.marginLeftTitle+o.getBBox().width,n+=c.marginBottomTitle+o.getBBox().height),s=0,x=c.slices.length;x>s;++s){var y=0;"undefined"==typeof c.slices[s].legendSpecificAttrs&&(c.slices[s].legendSpecificAttrs={}),w[s]=a.extend({},"plot"==g?f.map.defaultPlot.attrs:f.map.defaultArea.attrs,c.slices[s].attrs,c.slices[s].legendSpecificAttrs),"area"==g?("undefined"==typeof w[s].width&&(w[s].width=30),"undefined"==typeof w[s].height&&(w[s].height=20)):"square"==c.slices[s].type?("undefined"==typeof w[s].width&&(w[s].width=c.slices[s].size),"undefined"==typeof w[s].height&&(w[s].height=c.slices[s].size)):"image"==c.slices[s].type||"svg"==c.slices[s].type?("undefined"==typeof w[s].width&&(w[s].width=c.slices[s].width),"undefined"==typeof w[s].height&&(w[s].height=c.slices[s].height)):"undefined"==typeof w[s].r&&(w[s].r=c.slices[s].size/2),y=c.marginBottomTitle,o&&(y+=o.getBBox().height),y+="plot"!=g||"undefined"!=typeof c.slices[s].type&&"circle"!=c.slices[s].type?i*w[s].height/2:i*w[s].r,v=Math.max(v,y)}for("horizontal"==c.mode&&(m=c.marginLeft),s=0,x=c.slices.length;x>s;++s)if("undefined"==typeof c.slices[s].display||c.slices[s].display===!0){if("area"==g?("horizontal"==c.mode?(t=m+c.marginLeft,u=v-.5*i*w[s].height):(t=c.marginLeft,u=n),p=l.rect(t,u,i*w[s].width,i*w[s].height)):"square"==c.slices[s].type?("horizontal"==c.mode?(t=m+c.marginLeft,u=v-.5*i*w[s].height):(t=c.marginLeft,u=n),p=l.rect(t,u,i*w[s].width,i*w[s].height)):"image"==c.slices[s].type||"svg"==c.slices[s].type?("horizontal"==c.mode?(t=m+c.marginLeft,u=v-.5*i*w[s].height):(t=c.marginLeft,u=n),"image"==c.slices[s].type?p=l.image(c.slices[s].url,t,u,i*w[s].width,i*w[s].height):(p=l.path(c.slices[s].path),p.transform("m"+i*c.slices[s].width/p.getBBox().width+",0,0,"+i*c.slices[s].height/p.getBBox().height+","+t+","+u))):("horizontal"==c.mode?(t=m+c.marginLeft+i*w[s].r,u=v):(t=c.marginLeft+i*w[s].r,u=n+i*w[s].r),p=l.circle(t,u,i*w[s].r)),delete w[s].width,delete w[s].height,delete w[s].r,p.attr(w[s]),q=p.getBBox(),"horizontal"==c.mode?(t=m+c.marginLeft+q.width+c.marginLeftLabel,u=v):(t=c.marginLeft+q.width+c.marginLeftLabel,u=n+q.height/2),r=l.text(t,u,c.slices[s].label).attr(c.labelAttrs),"horizontal"==c.mode){var z=c.marginBottom+q.height;m+=c.marginLeft+q.width+c.marginLeftLabel+r.getBBox().width,"image"!=c.slices[s].type&&"area"!=g&&(z+=c.marginBottomTitle),o&&(z+=o.getBBox().height),n=Math.max(n,z)}else m=Math.max(m,c.marginLeft+q.width+c.marginLeftLabel+r.getBBox().width),n+=c.marginBottom+q.height;a(p.node).attr({"data-type":"elem","data-index":s,"data-hidden":0}),a(r.node).attr({"data-type":"label","data-index":s,"data-hidden":0}),c.hideElemsOnClick.enabled&&(r.attr({cursor:"pointer"}),p.attr({cursor:"pointer"}),d.setHoverOptions(p,w[s],w[s]),d.setHoverOptions(r,c.labelAttrs,c.labelAttrsHover),d.setHover(l,p,r),d.handleClickOnLegendElem(e,c,c.slices[s],r,p,h,j))}return"SVG"!=b.type&&c.VMLWidth&&(m=c.VMLWidth),l.setSize(m,n),l},d.handleClickOnLegendElem=function(b,c,d,e,f,g,h){var i=function(i,j){var k=0,l=a(e.node).attr("data-hidden"),m="0"===l?{"data-hidden":"1"}:{"data-hidden":"0"};"0"===l?e.animate({opacity:.5},c.hideElemsOnClick.animDuration):e.animate({opacity:1},c.hideElemsOnClick.animDuration),a.each(g,function(b){k=a.isArray(g[b].value)?g[b].value[h]:g[b].value,("undefined"!=typeof d.sliceValue&&k==d.sliceValue||"undefined"==typeof d.sliceValue&&("undefined"==typeof d.min||k>=d.min)&&("undefined"==typeof d.max||k<=d.max))&&!function(a){"0"===l?(g[a].mapElem.animate({opacity:c.hideElemsOnClick.opacity},c.hideElemsOnClick.animDuration,"linear",function(){0===c.hideElemsOnClick.opacity&&g[a].mapElem.hide()}),g[a].textElem&&g[a].textElem.animate({opacity:c.hideElemsOnClick.opacity},c.hideElemsOnClick.animDuration,"linear",function(){0===c.hideElemsOnClick.opacity&&g[a].textElem.hide()})):(0===c.hideElemsOnClick.opacity&&(g[a].mapElem.show(),g[a].textElem&&g[a].textElem.show()),g[a].mapElem.animate({opacity:"undefined"!=typeof g[a].mapElem.originalAttrs.opacity?g[a].mapElem.originalAttrs.opacity:1},c.hideElemsOnClick.animDuration),g[a].textElem&&g[a].textElem.animate({opacity:"undefined"!=typeof g[a].textElem.originalAttrs.opacity?g[a].textElem.originalAttrs.opacity:1},c.hideElemsOnClick.animDuration))}(b)}),a(f.node).attr(m),a(e.node).attr(m),"undefined"!=typeof j&&j!==!0||"undefined"==typeof c.exclusive||c.exclusive!==!0||a("[data-type='elem'][data-hidden=0]",b).each(function(){a(this).attr("data-index")!==a(f.node).attr("data-index")&&a(this).trigger("click",!1)})};a(e.node).on("click",i),a(f.node).on("click",i),"undefined"!=typeof d.clicked&&d.clicked===!0&&a(f.node).trigger("click",!1)},d.createLegends=function(b,c,e,f,g){var h=c.legend[e],i=[];a.isArray(c.legend[e])||(h=[c.legend[e]]);for(var j=0;j<h.length;++j)h[j].display===!0&&a.isArray(h[j].slices)&&h[j].slices.length>0&&i.push(d.drawLegend(h[j],b,c,e,f,g,j));return i},d.setHoverOptions=function(c,d,e){"SVG"!=b.type&&delete e.transform,c.attrsHover=e,c.attrsHover.transform?c.originalAttrs=a.extend({transform:"s1"},d):c.originalAttrs=d},d.setHover=function(b,c,e){var f={},g={},h=0,i=function(){h=setTimeout(function(){d.elemHover(b,c,e)},120)},j=function(){clearTimeout(h),d.elemOut(b,c,e)};f=a(c.node),f.on("mouseover",i),f.on("mouseout",j),e&&(g=a(e.node),g.on("mouseover",i),a(e.node).on("mouseout",j))},d.elemHover=function(a,b,c){b.animate(b.attrsHover,b.attrsHover.animDuration),c&&c.animate(c.attrsHover,c.attrsHover.animDuration),"function"==typeof a.safari&&a.safari()},d.elemOut=function(a,b,c){b.animate(b.originalAttrs,b.attrsHover.animDuration),c&&c.animate(c.originalAttrs,c.attrsHover.animDuration),"function"==typeof a.safari&&a.safari()},d.getElemOptions=function(b,c,e){var f=a.extend(!0,{},b,c);if("undefined"!=typeof f.value)if(a.isArray(e))for(var g=0,h=e.length;h>g;++g)f=a.extend(!0,{},f,d.getLegendSlice(f.value[g],e[g]));else f=a.extend(!0,{},f,d.getLegendSlice(f.value,e));return f},d.getTextPosition=function(a,b,c){var d=0,e=0,f="";switch(b){case"bottom":d=(a.x+a.x2)/2,e=a.y2+c,f="middle";break;case"top":d=(a.x+a.x2)/2,e=a.y-c,f="middle";break;case"left":d=a.x-c,e=(a.y+a.y2)/2,f="end";break;case"right":d=a.x2+c,e=(a.y+a.y2)/2,f="start";break;default:d=(a.x+a.x2)/2,e=(a.y+a.y2)/2,f="middle"}return{x:d,y:e,textAnchor:f}},d.getLegendSlice=function(a,b){for(var c=0,d=b.slices.length;d>c;++c)if("undefined"!=typeof b.slices[c].sliceValue&&a==b.slices[c].sliceValue||"undefined"==typeof b.slices[c].sliceValue&&("undefined"==typeof b.slices[c].min||a>=b.slices[c].min)&&("undefined"==typeof b.slices[c].max||a<=b.slices[c].max))return b.slices[c];return{}},d.animationIntervalID=null,d.animateViewBox=function(a,c,e,f,g,h,i,j){var k,l=c._viewBox?c._viewBox[0]:0,m=e-l,n=c._viewBox?c._viewBox[1]:0,o=f-n,p=c._viewBox?c._viewBox[2]:c.width,q=g-p,r=c._viewBox?c._viewBox[3]:c.height,s=h-r,t=25,u=i/t,v=0;j=j||"linear",k=b.easing_formulas[j],clearInterval(d.animationIntervalID),d.animationIntervalID=setInterval(function(){var b=v/u;c.setViewBox(l+m*k(b),n+o*k(b),p+q*k(b),r+s*k(b),!1),v++>=u&&(clearInterval(d.animationIntervalID),clearTimeout(d.zoomTO),d.zoomTO=setTimeout(function(){a.trigger("afterZoom",{x1:e,y1:f,x2:e+g,y2:f+h})},150))},t)},d.defaultOptions={map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultLink:{factor:.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},zoom:{enabled:!1,maxLevel:10,step:.25,zoomInCssClass:"zoomIn",zoomOutCssClass:"zoomOut",mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear"}},legend:{area:[],plot:[]},areas:{},plots:{},links:{}},d.legendDefaultOptions={area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2},slices:[],mode:"vertical"}},a.fn.mapael=d,a.fn.mapael});